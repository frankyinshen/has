<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evan's Grammar Adventure</title>
    <style>
        :root {
            --primary: #4A90E2;
            --success: #66BB6A;
            --warning: #FFA726;
            --danger: #EF5350;
            --bg: #F0F4F8;
            --card: #FFFFFF;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
        }

        .container {
            background-color: var(--card);
            width: 90%;
            max-width: 600px;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            border: 5px solid var(--primary);
        }

        h1 { color: var(--primary); margin-bottom: 10px; }
        h2 { color: #555; font-size: 1.2rem; }
        
        .rule-box {
            background-color: #E3F2FD;
            border: 2px dashed var(--primary);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: left;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .highlight { color: #D32F2F; font-weight: bold; background: #FFEBEE; padding: 2px 5px; border-radius: 4px; }
        .magic { color: #7B1FA2; font-weight: bold; }

        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            margin: 10px;
            width: 80%;
            max-width: 300px;
        }

        .btn:hover { transform: scale(1.05); background-color: #357ABD; }
        .btn:active { transform: scale(0.95); }

        .options-grid {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .option-btn {
            background-color: white;
            border: 3px solid #DDD;
            color: #555;
            padding: 15px;
            border-radius: 12px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-btn:hover { border-color: var(--primary); background-color: #F5F9FF; }

        .feedback-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .feedback-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 80%;
            max-width: 400px;
            text-align: center;
            animation: popIn 0.3s;
            border: 4px solid;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #EEE;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: var(--success);
            width: 0%;
            transition: width 0.5s;
        }

        .hidden { display: none; }
        
        .mascot { font-size: 3rem; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>

<div class="container" id="app">
    <!-- æ¬¢è¿é¡µé¢ -->
    <div id="welcome-screen">
        <span class="mascot">ğŸ¦</span>
        <h1>Hi, Evan! Ready to Play?</h1>
        <p>æˆ‘ä»¬å°†é€šè¿‡ä¸‰ä¸ªå…³å¡æ¥æˆä¸º "Have" ä¹‹ç‹ï¼</p>
        <p>ä½ å¿…é¡»é€šè¿‡ç¬¬ä¸€å…³ï¼Œæ‰èƒ½è§£é”ä¸‹ä¸€å…³å“¦ã€‚</p>
        <button class="btn" onclick="startLevel(1)">Start Level 1</button>
    </div>

    <!-- è§„åˆ™è®²è§£é¡µé¢ -->
    <div id="rule-screen" class="hidden">
        <span class="mascot">ğŸ“–</span>
        <h1 id="rule-title">Level Rules</h1>
        <div class="rule-box" id="rule-content"></div>
        <button class="btn" onclick="startQuiz()">I Understand! Let's Go!</button>
    </div>

    <!-- ç­”é¢˜é¡µé¢ -->
    <div id="quiz-screen" class="hidden">
        <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
        <h2 id="level-indicator">Level 1</h2>
        <div style="font-size: 1.5rem; margin: 30px 0;" id="question-text">
            Question goes here...
        </div>
        <div class="options-grid" id="options-container">
            <!-- é€‰é¡¹æŒ‰é’®ä¼šç”Ÿæˆåœ¨è¿™é‡Œ -->
        </div>
    </div>

    <!-- ç»“æœé¡µé¢ -->
    <div id="result-screen" class="hidden">
        <span class="mascot" id="result-emoji">ğŸ†</span>
        <h1 id="result-title">Level Complete!</h1>
        <p id="result-message">Good job, Evan!</p>
        <button class="btn" id="next-level-btn" onclick="nextStage()">Next Level â¡ï¸</button>
        <button class="btn" id="retry-btn" onclick="retryLevel()">Try Again ğŸ”„</button>
    </div>
</div>

<!-- åé¦ˆå¼¹çª— -->
<div class="feedback-modal" id="feedback-modal">
    <div class="feedback-content" id="feedback-box">
        <h2 id="fb-title"></h2>
        <p id="fb-text" style="font-size: 1.1rem; margin: 20px 0;"></p>
        <button class="btn" onclick="closeFeedback()">OK</button>
    </div>
</div>

<script>
    // é¢˜ç›®æ•°æ®åº“
    const gameData = {
        level1: {
            title: "Level 1: ç°åœ¨çš„æˆ‘å’Œä»–ï¼Œè¿˜æœ‰è¿‡å»",
            rule: `
                <strong>1. ç°åœ¨çš„ "Have" vs "Has"</strong><br>
                ğŸ‘‰ <strong>Have:</strong> æˆ‘(I)ã€ä½ (You)ã€å¤§å®¶(We/They/Cats)ã€‚<br>
                ğŸ‘‰ <strong>Has:</strong> ä»–(He)ã€å¥¹(She)ã€å®ƒ(It)ã€æ±¤å§†(Tom)ã€‚<br>
                <em>å£è¯€ï¼šHas æœ‰ä¸ª "s"ï¼Œé€ç»™å­¤å•çš„ "Single" (å•ä¸ªäºº)ã€‚</em><br><br>
                <strong>2. è¿‡å»çš„ "Had"</strong><br>
                ğŸ‘‰ åªè¦æ˜¯è¿‡å»çš„äº‹æƒ… (Yesterday, Last year)ï¼Œå¤§å®¶éƒ½ç”¨ <strong>Had</strong>ï¼
            `,
            questions: [
                { q: "I ______ a red bicycle.", options: ["have", "has", "had"], a: "have", type: "rule1" },
                { q: "She ______ a cute puppy.", options: ["have", "has", "had"], a: "has", type: "rule1" },
                { q: "Tom and Jerry ______ a big house.", options: ["have", "has", "had"], a: "have", type: "rule1" },
                { q: "Yesterday, we ______ pizza for lunch.", options: ["have", "has", "had"], a: "had", type: "rule2" },
                { q: "My cat ______ a long tail.", options: ["have", "has", "had"], a: "has", type: "rule1" }
            ]
        },
        level2: {
            title: "Level 2: é­”æ³•ç…§å¦–é•œ (Do/Does/Did)",
            rule: `
                <strong>âš ï¸ æœ€å®¹æ˜“é”™çš„åœ°æ–¹ï¼</strong><br><br>
                å½“å¥å­é‡Œå‡ºç°äº†å°å¸®æ‰‹ï¼š<br>
                <span class="highlight">Do / Does / Did</span><br>
                <span class="highlight">Don't / Doesn't / Didn't</span><br><br>
                åé¢çš„åŠ¨è¯å¿…é¡»è¢«æ‰“å›åŸå½¢ ğŸ‘‰ <strong>HAVE</strong>ã€‚<br>
                <em>ä¸ç®¡å‰é¢æ˜¯ He è¿˜æ˜¯ Sheï¼Œä¹Ÿä¸ç®¡æ˜¯ä¸æ˜¯æ˜¨å¤©ï¼</em>
            `,
            questions: [
                { q: "He doesn't ______ a car.", options: ["have", "has", "had"], a: "have", exp: "çœ‹åˆ° doesn't äº†å—ï¼ŸHas å¿…é¡»å˜å›åŸå½¢ Haveï¼" },
                { q: "Did you ______ fun at the park?", options: ["have", "has", "had"], a: "have", exp: "Did å‡ºç°äº†ï¼Had å¿…é¡»å˜å›åŸå½¢ Haveï¼" },
                { q: "Does she ______ a brother?", options: ["have", "has", "had"], a: "have", exp: "Does æ˜¯ç…§å¦–é•œï¼ŒShe åé¢çš„ Has è¦å˜å› Haveï¼" },
                { q: "I didn't ______ breakfast this morning.", options: ["have", "has", "had"], a: "have", exp: "Didn't å‡ºç°äº†ï¼Œå¿…é¡»ç”¨åŸå½¢ Haveã€‚" },
                { q: "Do they ______ a computer?", options: ["have", "has", "had"], a: "have", exp: "Do åé¢è·ŸåŸå½¢ Haveã€‚" }
            ]
        },
        level3: {
            title: "Level 3: æ­£åœ¨è¿›è¡Œ & ç»ˆæå¤§æŒ‘æˆ˜",
            rule: `
                <strong>1. æ­£åœ¨åš (Having)</strong><br>
                å¦‚æœæ˜¯ "æ­£åœ¨åƒ" æˆ– "æ­£åœ¨ç©"ï¼Œç”¨ <span class="magic">Having</span>ã€‚<br>
                <em>æ³¨æ„ï¼šHave å»æ‰ e å†åŠ  ingï¼</em><br><br>
                <strong>2. æ··åˆå¤§æŒ‘æˆ˜</strong><br>
                è¿™ä¸€å…³åŒ…å«äº†ä¹‹å‰å­¦è¿‡çš„æ‰€æœ‰é™·é˜±å“¦ï¼å°å¿ƒ Do/Does/Didï¼
            `,
            questions: [
                { q: "Look! They are ______ lunch now.", options: ["have", "has", "having"], a: "having", exp: "Now è¡¨ç¤ºæ­£åœ¨è¿›è¡Œï¼Œç”¨ Having (æ­£åœ¨åƒ)ã€‚" },
                { q: "Does the dog ______ a bone?", options: ["have", "has", "having"], a: "have", exp: "å°å¿ƒï¼Does å‡ºç°äº†ï¼Œè¦ç”¨åŸå½¢ Haveã€‚" },
                { q: "Last year, I ______ a blue bike.", options: ["have", "has", "had"], a: "had", exp: "Last year æ˜¯è¿‡å»ï¼Œè¦ç”¨ Hadã€‚" },
                { q: "We are ______ a party right now!", options: ["have", "had", "having"], a: "having", exp: "Right now è¡¨ç¤ºæ­£åœ¨è¿›è¡Œï¼Œç”¨ Havingã€‚" },
                { q: "She ______ a beautiful dress.", options: ["have", "has", "having"], a: "has", exp: "She æ˜¯ç¬¬ä¸‰äººç§°å•æ•°ï¼Œç”¨ Hasã€‚" }
            ]
        }
    };

    // æ¸¸æˆçŠ¶æ€
    let currentLevel = 1;
    let questionQueue = [];
    let currentQIndex = 0;
    let retryMode = false;

    // è·å–DOMå…ƒç´ 
    const app = document.getElementById('app');
    const screens = {
        welcome: document.getElementById('welcome-screen'),
        rule: document.getElementById('rule-screen'),
        quiz: document.getElementById('quiz-screen'),
        result: document.getElementById('result-screen')
    };

    function showScreen(screenId) {
        Object.values(screens).forEach(s => s.classList.add('hidden'));
        screens[screenId].classList.remove('hidden');
    }

    function startLevel(level) {
        currentLevel = level;
        const data = gameData['level' + level];
        
        document.getElementById('rule-title').innerText = data.title;
        document.getElementById('rule-content').innerHTML = data.rule;
        
        // åˆå§‹åŒ–é¢˜ç›®é˜Ÿåˆ—ï¼ˆæ·±æ‹·è´ï¼‰
        questionQueue = JSON.parse(JSON.stringify(data.questions));
        currentQIndex = 0;
        
        showScreen('rule');
    }

    function startQuiz() {
        showScreen('quiz');
        loadQuestion();
    }

    function loadQuestion() {
        const q = questionQueue[currentQIndex];
        document.getElementById('level-indicator').innerText = `Level ${currentLevel} - Question ${currentQIndex + 1}/${questionQueue.length}`;
        document.getElementById('question-text').innerText = q.q;
        
        const container = document.getElementById('options-container');
        container.innerHTML = '';
        
        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(opt);
            container.appendChild(btn);
        });

        // æ›´æ–°è¿›åº¦æ¡
        const percent = (currentQIndex / questionQueue.length) * 100;
        document.querySelector('.progress-fill').style.width = percent + '%';
    }

    function checkAnswer(selected) {
        const q = questionQueue[currentQIndex];
        const feedbackModal = document.getElementById('feedback-modal');
        const fbBox = document.getElementById('feedback-box');
        const fbTitle = document.getElementById('fb-title');
        const fbText = document.getElementById('fb-text');

        feedbackModal.style.display = 'flex';

        if (selected === q.a) {
            // å›ç­”æ­£ç¡®
            fbBox.style.borderColor = 'var(--success)';
            fbTitle.innerText = "Awesome, Evan! ğŸŒŸ";
            fbTitle.style.color = 'var(--success)';
            fbText.innerText = "ä½ ç­”å¯¹äº†ï¼ç»§ç»­åŠ æ²¹ï¼";
            
            // å¦‚æœè¿™é¢˜æ˜¯ä¹‹å‰åšé”™çš„ï¼Œç°åœ¨åšå¯¹äº†ï¼Œå°±ä¸éœ€è¦å†å¤„ç†äº†
        } else {
            // å›ç­”é”™è¯¯
            fbBox.style.borderColor = 'var(--danger)';
            fbTitle.innerText = "Oops! Evan, wait a second...";
            fbTitle.style.color = 'var(--danger)';
            
            let explanation = q.exp || "";
            if (!explanation) {
                // å¦‚æœæ²¡æœ‰ç‰¹å®šè§£é‡Šï¼Œç”Ÿæˆé€šç”¨è§£é‡Š
                if (q.a === 'have') explanation = "è®°ä½è§„åˆ™ï¼šI/You/We/They ç”¨ Haveï¼Œæˆ–è€…å‰é¢æœ‰ Do/Does/Did ä¹Ÿè¦ç”¨ Haveï¼";
                if (q.a === 'has') explanation = "è®°ä½è§„åˆ™ï¼šåªæœ‰ He/She/It å•ç‹¬ä¸€ä¸ªäººæ—¶æ‰ç”¨ Has å“¦ã€‚";
                if (q.a === 'had') explanation = "è¿™æ˜¯è¿‡å»å‘ç”Ÿçš„äº‹æƒ… (Yesterday/Last year)ï¼Œæ‰€ä»¥è¦ç”¨ Hadã€‚";
                if (q.a === 'having') explanation = "æ­£åœ¨åšæŸäº‹ (Now)ï¼Œè¦ç”¨ Havingã€‚";
            }
            
            fbText.innerHTML = `æ­£ç¡®ç­”æ¡ˆæ˜¯ <strong>${q.a}</strong>ã€‚<br><br>${explanation}<br><br>ğŸ‘‰ <strong>è¿™é“é¢˜æˆ‘ä»¬æŠŠå®ƒæ”¾åˆ°æœ€åï¼Œå†è€ƒä¸€æ¬¡å“¦ï¼</strong>`;
            
            // é”™é¢˜é€»è¾‘ï¼šæŠŠè¿™é“é¢˜å¤åˆ¶ä¸€ä»½åŠ åˆ°é˜Ÿåˆ—æœ«å°¾
            // æ ‡è®°ä¸ºé‡è¯•é¢˜ï¼Œé˜²æ­¢æ­»å¾ªç¯ç»Ÿè®¡
            if (!q.isRetry) {
                let retryQ = JSON.parse(JSON.stringify(q));
                retryQ.isRetry = true; 
                questionQueue.push(retryQ);
            }
        }
    }

    function closeFeedback() {
        document.getElementById('feedback-modal').style.display = 'none';
        currentQIndex++;
        
        if (currentQIndex < questionQueue.length) {
            loadQuestion();
        } else {
            finishLevel();
        }
    }

    function finishLevel() {
        showScreen('result');
        const totalQ = gameData['level' + currentLevel].questions.length;
        const totalAttempts = questionQueue.length;
        
        // å¦‚æœ Attempts > totalQï¼Œè¯´æ˜æœ‰é”™é¢˜é‡åšçš„æƒ…å†µ
        const isPerfect = totalAttempts === totalQ;

        if (isPerfect) {
            document.getElementById('result-emoji').innerText = "ğŸ†";
            document.getElementById('result-title').innerText = "Perfect! å¤ªæ£’äº†ï¼";
            document.getElementById('result-message').innerText = `Evan, ä½ åœ¨ Level ${currentLevel} è¡¨ç°å®Œç¾ï¼ä½ æ˜¯è¯­æ³•å°å¤©æ‰ï¼`;
            document.getElementById('next-level-btn').classList.remove('hidden');
            document.getElementById('retry-btn').classList.add('hidden');
            
            if (currentLevel === 3) {
                document.getElementById('next-level-btn').innerText = "å…¨éƒ¨é€šå…³ï¼ğŸ‰";
                document.getElementById('next-level-btn').onclick = () => alert("æ­å–œEvanå®Œæˆæ‰€æœ‰è®­ç»ƒï¼");
            }
        } else {
            document.getElementById('result-emoji').innerText = "ğŸ‘";
            document.getElementById('result-title').innerText = "Level Complete!";
            document.getElementById('result-message').innerText = `Evan, ä½ å®Œæˆäº† Level ${currentLevel}ï¼è™½ç„¶ä¸­é—´æœ‰å‡ ä¸ªå°é™·é˜±ï¼Œä½†ä½ æœ€åéƒ½ææ‡‚äº†ï¼Œå¾ˆæ£’ï¼`;
            
            // å³ä½¿æœ‰é”™é¢˜é‡åšï¼Œåªè¦æœ€åéƒ½æ¸…ç©ºäº†é˜Ÿåˆ—ï¼Œä¹Ÿç®—è¿‡å…³ï¼Œå…è®¸è¿›å…¥ä¸‹ä¸€å…³
            document.getElementById('next-level-btn').classList.remove('hidden');
            document.getElementById('retry-btn').classList.remove('hidden'); // å¯ä»¥é€‰æ‹©é‡åˆ·
            
            if (currentLevel === 3) {
                document.getElementById('next-level-btn').innerText = "å…¨éƒ¨é€šå…³ï¼ğŸ‰";
                document.getElementById('next-level-btn').onclick = () => alert("æ­å–œEvanå®Œæˆæ‰€æœ‰è®­ç»ƒï¼");
            }
        }
    }

    function nextStage() {
        if (currentLevel < 3) {
            startLevel(currentLevel + 1);
        } else {
            alert("ä½ å·²ç»é€šå…³äº†ï¼å»åƒä¸ªå†°æ·‡æ·‹åº†ç¥ä¸€ä¸‹å§ï¼ğŸ¦");
        }
    }

    function retryLevel() {
        startLevel(currentLevel);
    }

</script>

</body>
</html>
